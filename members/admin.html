<?php
session_start();
$account = false;
if (isset($_SESSION['token']) && strlen($_SESSION['token']) === 10) {
	require_once('../dbconfig.php');
	try {
		$dbh = new PDO($driver, $user, $pass, $attr);
		try {
			$stmt = $dbh->prepare('SELECT * FROM nhs_members WHERE token = :token');
			$stmt->bindParam(':token', $_SESSION['token'], PDO::PARAM_STR);
			$stmt->execute();
			while ($row = $stmt->fetch()) {
				$account = $row;
				break;
			}
			unset($stmt);
		} catch (Exception $f) {
			echo "Exception: " . $f->getMessage() . "<br />";
		}
	} catch (Exception $e) {
		$recipient = "dwheelerw@gmail.com";
		$subject = "ERROR - SQL Connection";
		$mail_body = "An exception occurred on the NHS admin fetcher: " . $e->getMessage();
		mail($recipient, $subject, $mail_body);
		die("Feature currently unavailable. Please try again later.");
	}
}
if ($account === false) {
	session_unset();
	session_destroy();
	header('Location: http://confiqure.uphero.com/nhs/members/');
}
?>
<!DOCTYPE html>
<html lang="en">

<head>

	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Section for NHS members to review their hours and responsibilites">
	<meta name="author" content="Dylan Wheeler">

	<title>National Honors Society</title>

	<!-- Bootstrap Core CSS -->
	<link href="../bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">

	<!-- Timeline CSS -->
	<link href="../css/timeline.css" rel="stylesheet">

	<!-- Custom CSS -->
	<link href="../css/sb-admin-2.css" rel="stylesheet">

	<!-- Custom Fonts -->
	<link href="../bower_components/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

</head>

<body>

	<!-- Navigation -->
	<nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="index.html">National Honors Society</a>
		</div>
		<!-- /.navbar-header -->
		 <ul class="nav navbar-top-links navbar-right">
			<li class="dropdown">
				<a class="dropdown-toggle" data-toggle="dropdown" href="#">
					<i class="fa fa-tasks fa-fw"></i>  <i class="fa fa-caret-down"></i>
				</a>
				<ul class="dropdown-menu dropdown-tasks">
					<?php
						$tutoring_percent = round(($account['tutoring'] > 5 ? 5 : $account['tutoring']) * 20);
						$community_percent = round(($account['community'] > 10 ? 10 : $account['community']) * 10);
						$total_percent = round((($account['tutoring'] > 5 ? 5 : $account['tutoring']) + ($account['community'] > 10 ? 10 : $account['community']) + ($account['tutoring'] + $account['community'] - 15)) * 5);
						if ($total_percent > 100) $total_percent = 100;
					?>
					<li>
						<a href="#">
							<div>
								<p>
									<strong>Tutoring</strong>
									<span class="pull-right text-muted"><?php echo $tutoring_percent; ?>% Complete</span>
								</p>
								<div class="progress progress-striped active">
									<div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: <?php echo $tutoring_percent; ?>%">
										<span class="sr-only"><?php echo $tutoring_percent; ?>% Complete</span>
									</div>
								</div>
							</div>
						</a>
					</li>
					<li class="divider"></li>
					<li>
						<a href="#">
							<div>
								<p>
									<strong>Community Service</strong>
									<span class="pull-right text-muted"><?php echo $community_percent; ?>% Complete</span>
								</p>
								<div class="progress progress-striped active">
									<div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: <?php echo $community_percent; ?>%">
										<span class="sr-only"><?php echo $community_percent; ?>% Complete</span>
									</div>
								</div>
							</div>
						</a>
					</li>
					<li class="divider"></li>
					<li>
						<a href="#">
							<div>
								<p>
									<strong>Total Hours</strong>
									<span class="pull-right text-muted"><?php echo $total_percent; ?>% Complete</span>
								</p>
								<div class="progress progress-striped active">
									<div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: <?php echo $total_percent; ?>%">
										<span class="sr-only"><?php echo $total_percent; ?>% Complete</span>
									</div>
								</div>
							</div>
						</a>
					</li>
				</ul>
				<!-- /.dropdown-tasks -->
			</li>
			<!-- /.dropdown -->
			<li class="dropdown">
				<a class="dropdown-toggle" data-toggle="dropdown" href="#">
					<i class="fa fa-user fa-fw"></i>  <i class="fa fa-caret-down"></i>
				</a>
				<ul class="dropdown-menu dropdown-user">
					<li><a href="#"><i class="fa fa-user fa-fw"></i> User Profile</a>
					</li>
					<li><a href="#"><i class="fa fa-gear fa-fw"></i> Settings</a>
					</li>
					<li class="divider"></li>
					<li><a href="logout.php"><i class="fa fa-sign-out fa-fw"></i> Logout</a>
					</li>
				</ul>
				<!-- /.dropdown-user -->
			</li>
			<!-- /.dropdown -->
		</ul>
		<!-- /.navbar-top-links -->
	</nav>

	<div class="container">

		<div class="row">
			<div class="col-lg-12">
				<h1 class="page-header"><?php echo $account['studentname'] . ($account['role'] !== 'Member' ? ' (' . $account['role'] . ')' : ''); ?></h1>
			</div>
			<!-- /.col-lg-12 -->
		</div>
		<!-- /.row -->

		<div class="row">
			<div class="col-lg-6 col-md-6">
				<div class="panel panel-red">
					<div class="panel-heading">
						<div class="row">
							<div class="col-xs-3">
								<i class="fa fa-university fa-5x"></i>
							</div>
							<div class="col-xs-9 text-right">
								<div class="huge"><?php echo $account['tutoring']; ?></div>
								<div>Tutoring Hours</div>
							</div>
						</div>
					</div>
					<a href="#">
						<div class="panel-footer">
							<span class="pull-left">View Details</span>
							<span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
							<div class="clearfix"></div>
						</div>
					</a>
				</div>
			</div>
			<div class="col-lg-6 col-md-6">
				<div class="panel panel-yellow">
					<div class="panel-heading">
						<div class="row">
							<div class="col-xs-3">
								<i class="fa fa-heart fa-5x"></i>
							</div>
							<div class="col-xs-9 text-right">
								<div class="huge"><?php echo $account['community']; ?></div>
								<div>Community Service Hours</div>
							</div>
						</div>
					</div>
					<a href="#">
						<div class="panel-footer">
							<span class="pull-left">View Details</span>
							<span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
							<div class="clearfix"></div>
						</div>
					</a>
				</div>
			</div>
		</div>
		<!-- /.row -->

		<div class="row">
			<div class="col-lg-8">
				<div class="panel panel-default">
					<div class="panel-heading">
						<i class="fa fa-bar-chart-o fa-fw"></i> Hour Log History
					</div>
					<!-- /.panel-heading -->
					<div class="panel-body">
						<div class="row">
							<div class="col-lg-12">
								<div class="table-responsive">
									<table class="table table-bordered table-hover table-striped">
										<thead>
											<tr>
												<th><center>Date</center></th>
												<th><center>Service</center></th>
												<th><center>Hours</center></th>
												<th><center>Description</center></th>
												<th><center>Approved?</center></th>
											</tr>
										</thead>
										<tbody>
											<?php
												if (strlen($account['approved']) === 0) {
													echo '<tr><td colspan="5">No service documented.</td></tr>';
												} else {
													$entries = explode(';', $account['approved']);
													foreach ($entries as $entry) {
														$components = explode('::', $entry);
														if (sizeof($components) !== 5) continue;
														echo '
											<tr>
												<td>' . $components[0] . '</td>
												<td>' . $components[1] . '</td>
												<td><center>' . $components[2] . '</center></td>
												<td>' . $components[3] . '</td>
												<td><center><i class="fa fa-' . $components[4] . ' fa-fw"></i></center></td>
											</tr>' . "\n";
													}
												}
											?>
										</tbody>
									</table>
								</div>
								<!-- /.table-responsive -->
							</div>
							<!-- /.col-lg-12 (nested) -->
						</div>
						<!-- /.row -->
					</div>
					<!-- /.panel-body -->
				</div>
				<!-- /.panel -->
			</div>
			<!-- /.col-lg-8 -->
			<div class="col-lg-4">
				<div class="panel panel-default">
					<div class="panel-heading">
						<i class="fa fa-bell fa-fw"></i> Notifications Panel
					</div>
					<!-- /.panel-heading -->
					<div class="panel-body">
						<div class="list-group">
							<a href="#" class="list-group-item">
								<i class="fa fa-comment fa-fw"></i> New Comment
								<span class="pull-right text-muted small"><em>4 minutes ago</em>
								</span>
							</a>
							<a href="#" class="list-group-item">
								<i class="fa fa-twitter fa-fw"></i> 3 New Followers
								<span class="pull-right text-muted small"><em>12 minutes ago</em>
								</span>
							</a>
							<a href="#" class="list-group-item">
								<i class="fa fa-envelope fa-fw"></i> Message Sent
								<span class="pull-right text-muted small"><em>27 minutes ago</em>
								</span>
							</a>
							<a href="#" class="list-group-item">
								<i class="fa fa-tasks fa-fw"></i> New Task
								<span class="pull-right text-muted small"><em>43 minutes ago</em>
								</span>
							</a>
							<a href="#" class="list-group-item">
								<i class="fa fa-upload fa-fw"></i> Server Rebooted
								<span class="pull-right text-muted small"><em>11:32 AM</em>
								</span>
							</a>
							<a href="#" class="list-group-item">
								<i class="fa fa-bolt fa-fw"></i> Server Crashed!
								<span class="pull-right text-muted small"><em>11:13 AM</em>
								</span>
							</a>
							<a href="#" class="list-group-item">
								<i class="fa fa-warning fa-fw"></i> Server Not Responding
								<span class="pull-right text-muted small"><em>10:57 AM</em>
								</span>
							</a>
							<a href="#" class="list-group-item">
								<i class="fa fa-shopping-cart fa-fw"></i> New Order Placed
								<span class="pull-right text-muted small"><em>9:49 AM</em>
								</span>
							</a>
							<a href="#" class="list-group-item">
								<i class="fa fa-money fa-fw"></i> Payment Received
								<span class="pull-right text-muted small"><em>Yesterday</em>
								</span>
							</a>
						</div>
						<!-- /.list-group -->
						<a href="#" class="btn btn-default btn-block">View All Alerts</a>
					</div>
					<!-- /.panel-body -->
				</div>
				<!-- /.panel -->
			</div>
			<!-- /.col-lg-4 -->
		</div>
		<!-- /.row -->
		<div class="row">
			<div class="col-lg-12">
				<div class="panel panel-default">
					<div class="panel-heading">
						<i class="fa fa-clock-o fa-fw"></i> Upcoming Events
					</div>
					<!-- /.panel-heading -->
					<div class="panel-body">
						<ul class="timeline">
							<li>
								<div class="timeline-badge"><i class="fa fa-check"></i>
								</div>
								<div class="timeline-panel">
									<div class="timeline-heading">
										<h4 class="timeline-title">Lorem ipsum dolor</h4>
										<p><small class="text-muted"><i class="fa fa-clock-o"></i> 11 hours ago via Twitter</small>
										</p>
									</div>
									<div class="timeline-body">
										<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Libero laboriosam dolor perspiciatis omnis exercitationem. Beatae, officia pariatur? Est cum veniam excepturi. Maiores praesentium, porro voluptas suscipit facere rem dicta, debitis.</p>
									</div>
								</div>
							</li>
							<li class="timeline-inverted">
								<div class="timeline-badge warning"><i class="fa fa-credit-card"></i>
								</div>
								<div class="timeline-panel">
									<div class="timeline-heading">
										<h4 class="timeline-title">Lorem ipsum dolor</h4>
									</div>
									<div class="timeline-body">
										<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Autem dolorem quibusdam, tenetur commodi provident cumque magni voluptatem libero, quis rerum. Fugiat esse debitis optio, tempore. Animi officiis alias, officia repellendus.</p>
										<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Laudantium maiores odit qui est tempora eos, nostrum provident explicabo dignissimos debitis vel! Adipisci eius voluptates, ad aut recusandae minus eaque facere.</p>
									</div>
								</div>
							</li>
							<li>
								<div class="timeline-badge danger"><i class="fa fa-bomb"></i>
								</div>
								<div class="timeline-panel">
									<div class="timeline-heading">
										<h4 class="timeline-title">Lorem ipsum dolor</h4>
									</div>
									<div class="timeline-body">
										<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Repellendus numquam facilis enim eaque, tenetur nam id qui vel velit similique nihil iure molestias aliquam, voluptatem totam quaerat, magni commodi quisquam.</p>
									</div>
								</div>
							</li>
							<li class="timeline-inverted">
								<div class="timeline-panel">
									<div class="timeline-heading">
										<h4 class="timeline-title">Lorem ipsum dolor</h4>
									</div>
									<div class="timeline-body">
										<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Voluptates est quaerat asperiores sapiente, eligendi, nihil. Itaque quos, alias sapiente rerum quas odit! Aperiam officiis quidem delectus libero, omnis ut debitis!</p>
									</div>
								</div>
							</li>
							<li>
								<div class="timeline-badge info"><i class="fa fa-save"></i>
								</div>
								<div class="timeline-panel">
									<div class="timeline-heading">
										<h4 class="timeline-title">Lorem ipsum dolor</h4>
									</div>
									<div class="timeline-body">
										<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Nobis minus modi quam ipsum alias at est molestiae excepturi delectus nesciunt, quibusdam debitis amet, beatae consequuntur impedit nulla qui! Laborum, atque.</p>
										<hr>
										<div class="btn-group">
											<button type="button" class="btn btn-primary btn-sm dropdown-toggle" data-toggle="dropdown">
												<i class="fa fa-gear"></i>  <span class="caret"></span>
											</button>
											<ul class="dropdown-menu" role="menu">
												<li><a href="#">Action</a>
												</li>
												<li><a href="#">Another action</a>
												</li>
												<li><a href="#">Something else here</a>
												</li>
												<li class="divider"></li>
												<li><a href="#">Separated link</a>
												</li>
											</ul>
										</div>
									</div>
								</div>
							</li>
							<li>
								<div class="timeline-panel">
									<div class="timeline-heading">
										<h4 class="timeline-title">Lorem ipsum dolor</h4>
									</div>
									<div class="timeline-body">
										<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Sequi fuga odio quibusdam. Iure expedita, incidunt unde quis nam! Quod, quisquam. Officia quam qui adipisci quas consequuntur nostrum sequi. Consequuntur, commodi.</p>
									</div>
								</div>
							</li>
							<li class="timeline-inverted">
								<div class="timeline-badge success"><i class="fa fa-graduation-cap"></i>
								</div>
								<div class="timeline-panel">
									<div class="timeline-heading">
										<h4 class="timeline-title">Lorem ipsum dolor</h4>
									</div>
									<div class="timeline-body">
										<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Deserunt obcaecati, quaerat tempore officia voluptas debitis consectetur culpa amet, accusamus dolorum fugiat, animi dicta aperiam, enim incidunt quisquam maxime neque eaque.</p>
									</div>
								</div>
							</li>
						</ul>
					</div>
					<!-- /.panel-body -->
				</div>
				<!-- /.panel -->
			</div>
		</div>
	</div>
	<!-- /#page-wrapper -->

	<!-- jQuery -->
	<script src="../bower_components/jquery/jquery.min.js"></script>

	<!-- Bootstrap Core JavaScript -->
	<script src="../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

	<!-- Custom Theme JavaScript -->
	<script src="../js/sb-admin-2.js"></script>

</body>

</html>
